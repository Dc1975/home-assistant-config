- id: '1685479368270'
  alias: GR Gartenbewässerung Überwachung Timer stop
  description: ''
  trigger:
#    - platform: state
#      entity_id:
#      - timer.ti_bz_motion_lights
#      to: idle
# see Bug https://github.com/home-assistant/home-assistant.io/pull/26352
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.ti_gr_lawn_sprinkler_observer
  condition: []
  action:
    - if:
      - condition: template
        value_template: "{{ states('switch.brunnen') == 'unavailable' }}"
      then:
      - service: script.turn_on
        target:
          entity_id: script.ha_handy_notification
        data:
          variables:
            msg_title: "{{states('input_text.it_general_notification_title')}} Garten"
            msg_message: "Die Rasenbewässerung kann nicht abgeschaltet werden. Der Schalter {{ state_attr('switch.brunnen', 'friendly_name') }} ist nicht verfügbar."
      - service: notify.alexa_media_uberall
        data:
          title: "{{states('input_text.it_general_notification_title')}} Garten"
          message: "Die Rasenbewässerung kann nicht abgeschaltet werden. Der Schalter {{ state_attr('switch.brunnen', 'friendly_name') }} ist nicht verfügbar."
          data:
            type: announce
            method: all              
      else:  
      - service: switch.turn_off
        data: {}
        target:
          entity_id: switch.brunnen
      - service: script.turn_on
        target:
          entity_id: script.ha_handy_notification
        data:
          variables:
            msg_title: "{{states('input_text.it_general_notification_title')}} Garten"
            msg_message: "Die Rasenbewässerung läuft länger als {{state_attr('input_number.in_gr_duration_lawn_sprinkler',
              'max') | int}} Minuten und wird abgeschaltet"
      - service: notify.alexa_media_uberall
        data:
          title: "{{states('input_text.it_general_notification_title')}} Garten"
          message: "Die Rasenbewässerung läuft länger als {{state_attr('input_number.in_gr_duration_lawn_sprinkler',
            'max') | int}} Minuten und wird abgeschaltet"
          data:
            type: announce
            method: all   
  mode: single